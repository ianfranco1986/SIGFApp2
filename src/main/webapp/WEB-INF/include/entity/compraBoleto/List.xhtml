<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition>
        <p:panel >
            <h3>Registro Factura/Compra Boletos</h3>
            <h:panelGroup id="display">
                <h:form id="CompraBoletoCreateForm">
                    <p:focus context="compraBoletoFolioFactura"/>
                    <p:panelGrid columns="2"  style="width: 100%;margin-bottom: 20px;" id="detalle" >
                        <h:outputLabel value="Folio" for="compraBoletoFolioFactura" />
                        <p:inputText id="compraBoletoFolioFactura" value="#{compraBoletoController.selected.compraBoletoFolioFactura}" title="#{myBundle.CreateCompraBoletoTitle_compraBoletoFolioFactura}" required="true" requiredMessage="#{myBundle.CreateCompraBoletoRequiredMessage_compraBoletoFolioFactura}" onfocus="this.setSelectionRange(0, this.value.length)">
                            <p:ajax event="valueChange" listener="#{compraBoletoController.findFolio}" update="growl"/>
                        </p:inputText>

                        <h:outputLabel value="Fecha" for="compraBoletoFecha" />
                        <p:calendar id="compraBoletoFecha" autocomplete="off" pattern="dd/MM/yyyy" value="#{compraBoletoController.selected.compraBoletoFecha}" title="#{myBundle.CreateCompraBoletoTitle_compraBoletoFecha}" required="true" requiredMessage="#{myBundle.CreateCompraBoletoRequiredMessage_compraBoletoFecha}" locale="es"/>

                        <h:outputLabel value=""/>
                        <h:panelGrid columns="6" id="detalleComprasPanel" >
                            <h:outputLabel style="margin-left: 5px;" value="Tipo Boleto" />
                            <h:outputLabel style="margin-left: 5px;" value="Identificador" />
                            <h:outputLabel style="margin-left: 5px;" value="Serie" for="serie"/>
                            <h:outputLabel style="margin-left: 5px;" value="N° Rollos" />
                            <h:outputLabel style="margin-left: 5px;" value="Valor x Rollo" />
                            <h:outputLabel style="margin-left: 5px;" value="Agregar"/>

                            <p:selectOneMenu style="margin-right: 5px; margin-bottom: -2px;" id="idBoleto" value="#{compraBoletoController.detalleCompraBoleto.detalleCompraBoletoIdBoleto}" requiredMessage="Debe seleccionar el tipo de boleto" required="true" converter="omnifaces.SelectItemsConverter" >
                                <f:selectItem itemLabel="Seleccionar"/>                                
                                <f:selectItems value="#{boletoController.items}"
                                               var="boletoItem"
                                               itemValue="#{boletoItem}"
                                               itemLabel="#{boletoItem.boletoNombre}"
                                               />
                            </p:selectOneMenu>

                            <p:inputText style="margin-left: 5px;" id="identificador" value="#{compraBoletoController.detalleCompraBoleto.detalleCompraBoletoIdentificador}" required="true" requiredMessage="Debe ingresar el identificador" size="10" maxlength="10" onfocus="this.setSelectionRange(0, this.value.length)" autocomplete="off" />

                            <p:inputText style="margin-left: 5px;" id="serie" value="#{compraBoletoController.detalleCompraBoleto.detalleCompraBoletoSerie}" required="true" requiredMessage="Debe ingresar la serie " size="10" maxlength="20" onfocus="this.setSelectionRange(0, this.value.length)" autocomplete="off" />

                            <p:inputText id="cantidadRollos" style="margin-left: 5px;" value="#{compraBoletoController.detalleCompraBoleto.detalleCompraBoletoCantidadRollos}" required="true" requiredMessage="Debe ingresar la cantidad de rollos" onfocus="this.setSelectionRange(0, this.value.length)" autocomplete="off" size="10"/>

                            <p:inputText id="valorXRollo" style="margin-left: 5px;" value="#{compraBoletoController.detalleCompraBoleto.detalleCompraBoletoTotal}" size="10" maxlength="5" onfocus="this.setSelectionRange(0, this.value.length)" required="true" requiredMessage="Debe ingresar el valor del rollo" >
                                <p:keyFilter mask="num" />
                            </p:inputText>

                            <p:commandButton id="addButton" style="margin-left: 5px;" value="Agregar" actionListener="#{compraBoletoController.addDetalleCompra}" styleClass="ui-priority-primary" update="DetalleCompraBoletoCreateForm:datalist, DetalleCompraBoletoCreateForm:totales, :growl, detalleComprasPanel, DetalleCompraBoletoCreateForm:saveButton" ajax="true">

                            </p:commandButton>                        
                        </h:panelGrid>
                    </p:panelGrid>
                </h:form>

                <h:panelGroup>
                    <h3>Detalle Boletos</h3>
                    <h:form id="DetalleCompraBoletoCreateForm">
                        <p:dataTable id="datalist"
                                     value="#{compraBoletoController.selected.detalleCompraBoletoList}" 
                                     widgetVar="datalist"
                                     var="item"
                                     rowKey="#{item.detalleCompraBoletoId}"                                 
                                     rowIndexVar="rowIndex"
                                     emptyMessage="No se han encontrado registros" 
                                     style="width: 100%"
                                     tableStyle="table-layout: auto" sortBy="#{item}">

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="N°"/>
                                </f:facet>
                                <h:outputLabel value="#{rowIndex+1}"/>
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Tipo Boleto"/>
                                </f:facet>
                                <h:outputLabel value="#{item.detalleCompraBoletoIdBoleto.boletoNombre}"/>
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Identificador"/>
                                </f:facet>
                                <h:outputLabel value="#{item.detalleCompraBoletoIdentificador}"/>
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Serie"/>
                                </f:facet>
                                <h:outputLabel value="#{item.detalleCompraBoletoSerie}"/>
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="N° Rollos"/>
                                </f:facet>
                                <h:outputLabel value="#{item.detalleCompraBoletoCantidadRollos}"/>
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Total"/>
                                </f:facet>
                                <h:outputLabel value="#{item.detalleCompraBoletoTotal}">
                                    <f:convertNumber currencyCode="$"/>
                                </h:outputLabel>
                            </p:column>

                            <p:summaryRow>
                                <p:column colspan="5" style="text-align:right">
                                    <h:outputText value="Total:" />
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{item.detalleCompraBoletoTotal}">
                                        <f:convertNumber type="currency" currencySymbol="$" />
                                    </h:outputText>
                                </p:column>
                            </p:summaryRow>

                        </p:dataTable>

                        <p:panelGrid style="width: 100%;margin-top: 10px;"  columns="1">
                            <h:panelGroup id="totales">
                                <h:outputLabel value="Total: " for="compraBoletoTotal" style="margin-right: 5px"/>
                                <p:inputNumber id="compraBoletoTotal" decimalPlaces="0" symbol="$" value="#{compraBoletoController.selected.compraBoletoTotal}" title="#{myBundle.CreateCompraBoletoTitle_compraBoletoTotal}" required="true" requiredMessage="#{myBundle.CreateCompraBoletoRequiredMessage_compraBoletoTotal}" onfocus="this.setSelectionRange(0, this.value.length)"/>
                            </h:panelGroup>
                            <f:facet name="footer">
                                <p:commandButton id="saveButton" actionListener="#{compraBoletoController.saveNew}" value="#{myBundle.Save}" disabled="#{empty compraBoletoController.selected.detalleCompraBoletoList}" update="display,:growl, :CompraBoletoCreateForm:detalle, datalist" onstart="PF('Loading').show()" onsuccess="PF('Loading').hide()" >
                                    <p:confirm header="#{myBundle.ConfirmationHeader}" message="#{myBundle.ConfirmCreateMessage}" icon="ui-icon-alert"/>
                                </p:commandButton>
                                <p:commandButton value="#{myBundle.Cancel}" update="display" process="@this" immediate="true" resetValues="true"/>
                            </f:facet>
                        </p:panelGrid>
                        <ui:include src="/confirmation.xhtml"/>
                    </h:form>
                </h:panelGroup>
            </h:panelGroup>
        </p:panel>
    </ui:composition>    
</html>