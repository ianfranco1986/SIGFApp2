<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <script>
        $(function () {
            PF('bui').show();
        });
    </script>
    <h:form id="Selector" >
        <p:panel style="width: 100%;margin-bottom: 20px;" id="selector">
            <h5 style="text-align: center;">Periodo</h5>
            <p:panelGrid columns="8" style="width: 100%; margin-top: 20px;"  columnClasses="ui-grid-col-2,ui-grid-col-10"  layout="grid" styleClass="ui-panelgrid-blank" >

                <h:outputLabel for="mes" value="Mes:" />
                <p:selectOneMenu id="mes" value="#{compraController.mes}" style="width:125px">
                    <f:selectItem itemLabel="Enero" itemValue="1" />
                    <f:selectItem itemLabel="Febrero" itemValue="2" />
                    <f:selectItem itemLabel="Marzo" itemValue="3" />
                    <f:selectItem itemLabel="Abril" itemValue="4" />
                    <f:selectItem itemLabel="Mayo" itemValue="5" />
                    <f:selectItem itemLabel="Junio" itemValue="6" />
                    <f:selectItem itemLabel="Julio" itemValue="7" />
                    <f:selectItem itemLabel="Agosto" itemValue="8" />
                    <f:selectItem itemLabel="Septiembre" itemValue="9" />
                    <f:selectItem itemLabel="Octubre" itemValue="10" />
                    <f:selectItem itemLabel="Noviembre" itemValue="11" />
                    <f:selectItem itemLabel="Diciembre" itemValue="12" />
                </p:selectOneMenu>


                <h:outputLabel for="anio" value="Año:" />
                <p:inputText id="anio" value="#{compraController.anio}" size="5" />

                <p:commandButton value="Buscar" actionListener="#{compraController.load}" update="CompraListForm:datalist, :growl" onstart="PF('Loading').show()" onsuccess="PF('Loading').hide()" oncomplete="PF('bui').hide()">

                </p:commandButton>

            </p:panelGrid>
        </p:panel>

    </h:form>
    
    <h:form id="CompraListForm">
        <p:panel style="margin-top: 20px; width: 100%" id="detalleCartola">
            <h3>Detalle Movimientos</h3>
            <p:dataTable id="datalist"
                         value="#{compraController.model}"
                         lazy="false"
                         rowKey="#{item.compraId}"
                         var="item"
                         selectionMode="single"
                         selection="#{compraController.selected}"
                         filteredValue="#{compraController.filteredItems}"
                         emptyMessage="No se han encontrado registros"
                         rowIndexVar="rowIndex"
                         >
                <!--
                         To enable Lazy Loading, please copy/replace the following lines above,
                         and be sure to replace the word HASH with the # symbol:
                
                         value="HASH{compraController.lazyItems}"
                         lazy="true"
                         rowKey="HASH{item.compraId}"  <<< Remove this line
                -->

                <p:ajax event="rowEdit" listener="#{compraController.onRowEdit}" update=":growl" />

                <p:column>
                    <f:facet name="header">
                        <h:outputText value="#"/>
                    </f:facet>
                    <h:outputText value="#{rowIndex+1}"/>
                </p:column>

                <p:column sortBy="#{item.compraFolio}" filterBy="#{item.compraFolio}">
                    <f:facet name="header">
                        <h:outputText value="Folio"/>
                    </f:facet>
                    <h:outputText value="#{item.compraFolio}">
                        <f:convertNumber/>
                    </h:outputText>
                </p:column>

                <p:column sortBy="#{item.compraFechaDocumento}" filterBy="#{item.compraFechaDocumento}">
                    <f:facet name="header">
                        <h:outputText value="Fecha"/>
                    </f:facet>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{item.compraFechaDocumento}">
                                <f:convertDateTime pattern="dd/MM/yyyy" />
                            </h:outputText>
                        </f:facet>
                        <f:facet name="input">
                            <p:calendar id="fechaDocumento" pattern="dd/MM/yy" onfocus="this.setSelectionRange(0, 2)" locale="es" value="#{item.compraFechaDocumento}" required="true" requiredMessage="Debe ingresar la fecha de la factura" />
                        </f:facet>
                    </p:cellEditor>

                </p:column>

                <p:column sortBy="#{item.compraCuentaMayorId.cuentaMayorNombre}" filterBy="#{item.compraCuentaMayorId.cuentaMayorNombre}">
                    <f:facet name="header">
                        <h:outputText value="Cuenta"/>
                    </f:facet>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{item.compraCuentaMayorId.cuentaMayorNombre}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:selectOneMenu id="cuenta" value="#{item.compraCuentaMayorId}" required="true" requiredMessage="Debe seleccionar la Cuenta" converter="omnifaces.SelectItemsConverter" filter="true" filterMatchMode="contains">
                                <f:selectItem itemLabel="#{myBundle.SelectOneMessage}"/>
                                <f:selectItems value="#{compraController.cuentaMayorItems}"
                                               var="cuentaMayorItem"
                                               itemValue="#{cuentaMayorItem}"
                                               itemLabel="#{cuentaMayorItem.cuentaMayorNombre})"
                                               />
                            </p:selectOneMenu>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column sortBy="#{item.compraProveedorId.proveedorNombre}" filterBy="#{item.compraProveedorId.proveedorNombre}">
                    <f:facet name="header">
                        <h:outputText value="Proveedor"/>
                    </f:facet>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{item.compraProveedorId.proveedorNombre}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:selectOneMenu id="proveedor" value="#{item.compraProveedorId}" required="true" requiredMessage="Debe seleccionar el Proveedor" converter="omnifaces.SelectItemsConverter" filter="true" filterMatchMode="contains">
                                <f:selectItem itemLabel="#{myBundle.SelectOneMessage}"/> 
                                <f:selectItems value="#{compraController.proveedorItems}"
                                               var="proveedorItem"
                                               itemValue="#{proveedorItem}"
                                               itemLabel="#{proveedorItem.proveedorNombre})"
                                               />
                            </p:selectOneMenu>
                        </f:facet>
                    </p:cellEditor>

                </p:column>

                <p:column sortBy="#{item.compraTipoDocumentoId.tipoDocumentoNombre}" filterBy="#{item.compraTipoDocumentoId.tipoDocumentoNombre}">
                    <f:facet name="header">
                        <h:outputText value="Documento"/>
                    </f:facet>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{item.compraTipoDocumentoId.tipoDocumentoNombre}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:selectOneMenu id="tipoDocumento" value="#{item.compraTipoDocumentoId}" required="true" requiredMessage="Debe seleccionar el Tipo del Documento" converter="omnifaces.SelectItemsConverter" filter="true" filterMatchMode="contains">
                                <f:selectItem itemLabel="#{myBundle.SelectOneMessage}"/> 
                                <f:selectItems value="#{compraController.tipoDocumentoItems}"
                                               var="tipoDocumentoItem"
                                               itemValue="#{tipoDocumentoItem}"
                                               itemLabel="#{tipoDocumentoItem.tipoDocumentoNombre})"
                                               />
                            </p:selectOneMenu>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column sortBy="#{item.compraDescripcion}" filterBy="#{item.compraDescripcion}">
                    <f:facet name="header">
                        <h:outputText value="Descripción"/>
                    </f:facet>
                    <h:outputText value="#{item.compraDescripcion}"/>
                </p:column>

                <p:column sortBy="#{item.compraNeto}" filterBy="#{item.compraNeto}">
                    <f:facet name="header">
                        <h:outputText value="Neto"/>
                    </f:facet>
                    <h:outputText value="#{item.compraNeto}">
                        <f:convertNumber/>
                    </h:outputText>
                </p:column>

                <p:column sortBy="#{item.compraExento}" filterBy="#{item.compraExento}">
                    <f:facet name="header">
                        <h:outputText value="Exento"/>
                    </f:facet>
                    <h:outputText value="#{item.compraExento}">
                        <f:convertNumber/>
                    </h:outputText>
                </p:column>

                <p:column sortBy="#{item.compraIva}" filterBy="#{item.compraIva}">
                    <f:facet name="header">
                        <h:outputText value="IVA"/>
                    </f:facet>
                    <h:outputText value="#{item.compraIva}">
                        <f:convertNumber/>
                    </h:outputText>
                </p:column>

                <p:column sortBy="#{item.compraTotal}" filterBy="#{item.compraTotal}">
                    <f:facet name="header">
                        <h:outputText value="Total"/>
                    </f:facet>
                    <h:outputText value="#{item.compraTotal}">
                        <f:convertNumber/>
                    </h:outputText>
                </p:column>

                <p:column style="width:55px;text-align: center">
                    <h:commandLink id="link2"  styleClass="btn btn-primary"  actionListener="#{reportController.downloadFile(compraController.informe, compraController.map)}" target="blank">
                        <f:setPropertyActionListener value="#{item}" target="#{compraController.selected}"  />
                        <h:outputText value="" class="ui-icon ui-icon-print"/>
                    </h:commandLink>
                </p:column>

                <p:column style="width:45px">
                    <p:commandButton id="editButton"   styleClass="btn btn-primary" icon="fa fa-pencil" update=":growl" disabled="#{empty compraController.selected}" onstart="PF('Loading').show()" onsuccess="PF('Loading').hide()" actionListener="#{compraController.prepareUpdate}"/>
                </p:column>

                <p:column style="width:45px;text-align: center">

                    <p:commandButton update="CompraListForm:datalist, :growl" icon="fa fa-trash" actionListener="#{compraController.delete}" onstart="PF('Loading').show()" onsuccess="PF('Loading').hide()">
                        <f:setPropertyActionListener value="#{item}" target="#{compraController.selected}"  />
                        <p:confirm header="#{myBundle.ConfirmationHeader}" message="#{myBundle.ConfirmDeleteMessage}" icon="fa fa-warning"/>
                    </p:commandButton>
                </p:column>

            </p:dataTable>

        </p:panel>
        <ui:include src="/WEB-INF/include/confirmation.xhtml"/>
    </h:form>

    

</ui:composition>