<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title">Carga Masiva | Compras</ui:define>

    <ui:define name="content">
        <h:form id="Selector" >
            <p:panel style="width: 100%;margin-bottom: 20px;" id="selector">
                <h4>Carga Masiva | Compras</h4><h6>PASO N°3: Edición Individual</h6>
                <div class="ui-fluid">
                    <div class="p-field">
                        <label for="mes">Mes/Año</label>
                        <p:datePicker id="month" view="month" value="#{edicionComprasController.date}"
                                      pattern="MM/yyyy"
                                      yearNavigator="true" yearRange="2022:2030" locale="es">
                        </p:datePicker>
                    </div>                     
                </div>
            </p:panel>

        </h:form>


        <div class="p-grid crud-demo">
            <div class="p-col-12">

                <div class="card">
                    <h:form id="CargaMasivaForm">                        
                        <p:toolbar styleClass="p-mb-4">
                            <p:toolbarGroup>


                                <p:commandButton id="delete-products-button" value="#{edicionComprasController.deleteButtonMessage}" icon="pi pi-trash" actionListener="#{edicionComprasController.deleteSelectedGuias}"
                                                 styleClass="ui-button-danger" disabled="#{!edicionComprasController.hasSelectedGuias()}" update=":growl, delete-products-button">
                                    <p:confirm header="Confirmación" message="¿Cancelar?" icon="pi pi-exclamation-triangle" />
                                </p:commandButton>
                            </p:toolbarGroup>

                            <p:toolbarGroup align="right">
                                <p:linkButton outcome="Procesamiento" icon="pi pi-arrow-circle-right"  value="Edición Individual" style="margin-right:20px;" styleClass="ui-button-success"/>
                            </p:toolbarGroup>
                        </p:toolbar>
                    </h:form>
                    <p:panel id="ComprasCreateDlg" widgetVar="CompraCreateDialog" header="Edición Individual | Carga Masiva Compras">
                        <h:form id="CompraCreateForm">
                            <div class="p-grid">
                                <div class="p-col-9">

                                    <div class="p-col-12">
                                        <div class="p-col-11">
                                            <div class="ui-fluid p-formgrid p-grid">
                                                <div class="p-field p-col-12 p-md-4">
                                                    <label>F. Acuse</label>
                                                    <p:datePicker value="#{edicionComprasController.selected.compraFechaAcuse}" id="acuse3" tabindex="1" placeholder="F.Acuse" showButtonBar="true" triggerButtonIcon="true" disabled="true"/>
                                                </div>
                                                <div class="p-field p-col-12 p-md-4">
                                                    <label>F.Documento</label>
                                                    <p:datePicker value="#{edicionComprasController.selected.compraFechaDocumento}" id="fecha3" type="text"  tabindex="2" placeholder="F.Documento" showButtonBar="true" disabled="true"/>
                                                </div>
                                                <div class="p-field p-col-12 p-md-4">
                                                    <label>F.Recepción</label>
                                                    <p:datePicker value="#{edicionComprasController.selected.compraFechaRecepcion}" id="recepcion3"  tabindex="3" placeholder="F.Recepción" showButtonBar="true" disabled="true"/>
                                                </div>
                                            </div>
                                            <div class="ui-fluid p-formgrid p-grid">
                                                <div class="p-field p-col-12 p-md-4">
                                                    <label>N° Documento</label>
                                                    <p:inputText value="#{edicionComprasController.selected.compraFolio}" id="zip" type="text" autocomplete="off"  tabindex="4" placeholder="N° de Docto." disabled="true"/>
                                                </div>
                                                <div class="p-field p-col-12 p-md-1">
                                                    <label style="visibility: hidden;">Buscar</label>
                                                    <p:commandButton icon="pi pi-search" />
                                                </div>
                                                <div class="p-field p-col-12 p-md-7">
                                                    <label>Tipo Documento</label>
                                                    <p:inputText value="#{edicionComprasController.selected.compraTipoDocumentoId.tipoDocumentoNombre}" id="tipoDocumento" type="text" autocomplete="off"  tabindex="5" placeholder="Tipo Documento" disabled="true"/>
                                                </div>
                                            </div>
                                            <div class="ui-fluid p-formgrid p-grid">
                                                <div class="p-field p-col-12 p-md-8">
                                                    <label>Proveedor</label>
                                                    <p:inputText value="#{edicionComprasController.selected.compraProveedorId.proveedorNombre}" id="proveedorNombre" type="text" autocomplete="off"  tabindex="6" placeholder="Proveedor" disabled="true"/>
                                                </div>

                                                <div class="p-field p-col-12 p-md-1">
                                                    <label style="visibility: hidden;">Agregar</label>
                                                </div>
                                            </div>
                                            <div class="ui-fluid p-formgrid p-grid">
                                                <div class="p-field p-col-12 p-md-12">
                                                    <label>Glosa</label>
                                                    <p:inputTextarea value="#{edicionComprasController.selected.compraDescripcion}" rows="4" cols="33" placeholder="Glosa" tabindex="7" />
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                </div>
                                <div class="p-col-3">
                                    <div class="p-col-12 ">
                                        <div class="p-col-10 ">
                                            <div class="ui-fluid p-formgrid ">
                                                <div class="p-field p-grid">
                                                    <label>Neto</label>
                                                    <p:inputNumber value="#{edicionComprasController.selected.compraNeto}" id="neto" decimalPlaces="0"  tabindex="8" />
                                                </div>
                                                <div class="p-field p-grid">
                                                    <label>Exento</label>
                                                    <p:inputNumber value="#{edicionComprasController.selected.compraExento}" id="exento" decimalPlaces="0"  tabindex="9"/>
                                                </div>
                                                <div class="p-field p-grid">
                                                    <label>IVA</label>
                                                    <p:inputNumber value="#{edicionComprasController.selected.compraIvaRecuperable}" id="iva" decimalPlaces="0"  tabindex="10"/>
                                                </div>
                                                <div class="p-field p-grid">
                                                    <label>Otros. Impuestos</label>
                                                    <p:inputNumber value="#{edicionComprasController.selected.compraOtrosImpuestos}" id="otros" decimalPlaces="0" disabled="true"/>
                                                </div>
                                                <div class="p-field p-grid">
                                                    <label>Total</label>
                                                    <p:inputNumber value="#{edicionComprasController.selected.compraTotal}" id="total" decimalPlaces="0"  disabled="true"/>
                                                </div>
                                            </div>
                                        </div>                            
                                    </div>
                                </div>
                            </div>

                            <div class="card" >
                                <div class="p-grid">
                                    <div class="p-col-2">
                                        <p:selectBooleanCheckbox id="checkboxIVAComun" value="#{edicionComprasController.selected.compraIuc}" itemLabel="IVA uso común"/>
                                        <p:tooltip for="checkboxIVAComun" value="Monto será asignado automáticamente a la cuenta única IVA" position="right"/>                          
                                    </div>
                                    <div class="p-col-2">
                                        <p:selectBooleanCheckbox id="compraSupermercado" value="#{edicionComprasController.selected.compraSm}" itemLabel="Compra de supermercado"/>
                                    </div>

                                    <div class="p-col-2">
                                        <p:selectBooleanCheckbox id="sinCF" value="#{edicionComprasController.selected.compraInr}" itemLabel="Sin derecho CF"/>
                                        <p:tooltip for="sinCF" value="Compras sin derecho a crédito fiscal" position="right"/>                          
                                    </div>
                                    <div class="p-col-2">
                                        <p:selectBooleanCheckbox id="ley18211" value="#{edicionComprasController.selected.compraInr}" itemLabel="Ley N° 18.211"/>
                                        <p:tooltip for="ley18211" value="IVA a las importaciones extranjeras" position="right"/>   
                                    </div>
                                    <div class="p-col-3">
                                        <p:selectBooleanCheckbox id="noIncluir" value="#{edicionComprasController.selected.compraInr}" itemLabel="Compra que no corresponde incluir"/>
                                        <p:tooltip for="noIncluir" value="Compras no necesarias para el desarrollo de la actividad" position="right"/>   
                                    </div>
                                    <div class="p-col-1">
                                        <p:selectBooleanCheckbox id="activoFijo" value="#{edicionComprasController.selected.compraAf}" itemLabel="Es AF"/>
                                        <p:tooltip for="activoFijo" value="Compra es un Activo Fijo" position="right"/>   
                                    </div>
                                </div>
                            </div>



                            <p:divider align="left" >
                                <b>Cuentas</b>
                            </p:divider>

                            <p:dataTable id="datalist"
                                         widgetVar="datalistWidget"
                                         value="#{edicionComprasController.movimientoItems}"
                                         selection="#{edicionComprasController.movimiento}"
                                         selectionMode="single"
                                         lazy="false"
                                         rowKey="#{item.voucherMovimientoId}"
                                         var="item"
                                         emptyMessage="No se han encontrado registros"
                                         rowIndexVar="rowIndex"
                                         scrollable="true" 
                                         scrollWidth="98%"
                                         editable="true"
                                         editMode="cell"
                                         >
                                <!--
                                         To enable Lazy Loading, please copy/replace the following lines above,
                                         and be sure to replace the word HASH with the # symbol:
                                
                                         value="HASH{proComprasController.lazyItems}"
                                         lazy="true"
                                         rowKey="HASH{item.compraId}"  <<< Remove this line
                                -->

                                <p:ajax event="rowSelect" update=":CargaMasivaForm:delete-products-button" />
                                <p:ajax event="rowUnselect" update=":CargaMasivaForm:delete-products-button" />
                                <p:ajax event="rowSelectCheckbox" update=":CargaMasivaForm:delete-products-button"/>
                                <p:ajax event="rowUnselectCheckbox" update=":CargaMasivaForm:delete-products-button" />
                                <p:ajax event="toggleSelect" update=":CargaMasivaForm:delete-products-button" />

                                <p:ajax event="cellEdit" listener="#{edicionComprasController.onCellEdit}" update=":growl"/>


                                <p:column width="20">
                                    <f:facet name="header">
                                        <h:outputText value="#"/>
                                    </f:facet>
                                    <h:outputText value="#{rowIndex+1}"/>
                                </p:column>

                                <p:column sortBy="#{item.voucherMovimientoCuentaId.cuentaMayorNombre}" width="80">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="Cuenta"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:autoComplete id="cuenta" 
                                                            value="#{item.voucherMovimientoCuentaId}" 
                                                            converter="cuentaMayorConverter" 
                                                            completeMethod="#{edicionComprasController.completeText}" 
                                                            var="country" 
                                                            itemLabel="#{country.cuentaMayorNombre}" 
                                                            itemValue="#{country}"
                                                            required="true"
                                                            forceSelection="true" 
                                                            scrollHeight="250"
                                                            dropdown="true"
                                                            > 
                                            </p:autoComplete>
                                        </f:facet>
                                    </p:cellEditor>

                                </p:column>

                                <p:column sortBy="#{item.voucherMovimientoCentroCostoId.centroCostoNombre}" width="80">
                                    <f:facet name="header">
                                        <h:outputText value="Centro Costo"/>
                                    </f:facet>
                                    <h:outputText value="#{(item.voucherMovimientoCentroCostoId.centroCostoId == 1)? '':item.voucherMovimientoCentroCostoId.centroCostoNombre}"/>
                                </p:column>

                                <p:column sortBy="#{item.voucherMovimientoMonto}" width="70">
                                    <f:facet name="header">
                                        <h:outputText value="Total"/>
                                    </f:facet>
                                    <h:outputText value="#{item.voucherMovimientoMonto}">
                                        <f:convertNumber/>
                                    </h:outputText>
                                </p:column>

                                <p:column exportable="false" width="50">

                                    <p:commandButton class="ui-button-danger rounded-button" icon="pi pi-trash" update="datalist" process="@this" oncomplete="PF('deleteProductDialog').show()" >
                                        <f:setPropertyActionListener value="#{item}" target="#{proComprasController.selected}" />
                                    </p:commandButton>
                                </p:column>

                            </p:dataTable>

                        </h:form>

                    </p:panel>

                </div>
                <ui:include src="/WEB-INF/include/confirmation.xhtml"/>
            </div>
        </div>


    </ui:define>
</ui:composition>